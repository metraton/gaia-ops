{
  "version": "1.0.0",
  "description": "DEPRECATED (002-progressive-context-enrichment): Replaced by context-contracts.{provider}.json and context_writer module. This file is retained for backward compatibility only.",
  "rules": [
    {
      "id": "rule_new_namespace",
      "category": "new_resource",
      "target_section": "cluster_details",
      "patterns": [
        "(?:discovered|found|detected)\\s+(?:new\\s+)?namespace\\s+['\"]?([\\w-]+)['\"]?",
        "namespace\\s+['\"]?([\\w-]+)['\"]?\\s+(?:exists|is present|was found)\\s+(?:but\\s+)?not\\s+in\\s+(?:project[- ]?)?context"
      ],
      "negative_patterns": [
        "kubectl\\s+(?:create|delete)\\s+namespace",
        "creating\\s+namespace",
        "deleting\\s+namespace"
      ],
      "confidence_weight": 0.8,
      "extract_fields": {
        "name": "$1"
      }
    },
    {
      "id": "rule_new_service",
      "category": "new_resource",
      "target_section": "application_services",
      "patterns": [
        "(?:discovered|found|detected)\\s+(?:new\\s+)?service\\s+['\"]?([\\w-]+)['\"]?\\s+(?:running|deployed|active)\\s+in\\s+(?:namespace\\s+)?['\"]?([\\w-]+)['\"]?",
        "service\\s+['\"]?([\\w-]+)['\"]?\\s+is\\s+(?:running|active|deployed)\\s+(?:on|at)\\s+port\\s+(\\d+)",
        "(?:new|unknown)\\s+(?:helm\\s+)?release\\s+['\"]?([\\w-]+)['\"]?"
      ],
      "negative_patterns": [
        "kubectl\\s+(?:create|apply|delete)\\s+(?:service|svc)",
        "helm\\s+(?:install|upgrade|uninstall)"
      ],
      "confidence_weight": 0.85,
      "extract_fields": {
        "service_name": "$1",
        "namespace": "$2"
      }
    },
    {
      "id": "rule_new_bucket",
      "category": "new_resource",
      "target_section": "infrastructure_topology",
      "patterns": [
        "(?:discovered|found|detected)\\s+(?:GCS\\s+)?bucket\\s+['\"]?([\\w.-]+)['\"]?",
        "bucket\\s+['\"]?([\\w.-]+)['\"]?\\s+exists\\s+in\\s+(?:region\\s+)?['\"]?([\\w-]+)['\"]?"
      ],
      "negative_patterns": [
        "gsutil\\s+(?:mb|rb)",
        "creating\\s+bucket"
      ],
      "confidence_weight": 0.8,
      "extract_fields": {
        "bucket_name": "$1",
        "region": "$2"
      }
    },
    {
      "id": "rule_iam_binding",
      "category": "new_resource",
      "target_section": "infrastructure_topology",
      "patterns": [
        "(?:IAM|iam)\\s+binding\\s+(?:between|for|on)\\s+['\"]?([\\w@.-]+)['\"]?\\s+(?:and|to|on)\\s+['\"]?([\\w@.-]+)['\"]?",
        "(?:workload\\s+identity|WI)\\s+binding\\s+.*?['\"]?([\\w@.-]+)['\"]?"
      ],
      "negative_patterns": [
        "gcloud\\s+iam",
        "adding\\s+(?:IAM|iam)\\s+binding"
      ],
      "confidence_weight": 0.8,
      "extract_fields": {
        "principal": "$1",
        "resource": "$2"
      }
    },
    {
      "id": "rule_configuration_issue",
      "category": "configuration_issue",
      "target_section": "project_details",
      "patterns": [
        "configuration\\s+issue[:\\s]+(.+?)(?:\\.|$)",
        "(?:misconfigur|wrong|incorrect|broken)(?:ed|ation)?\\s+(.+?)(?:\\.|$)",
        "(?:references|points to)\\s+(?:wrong|incorrect)\\s+(?:project|bucket|service|account)\\s+['\"]?([\\w.-]+)['\"]?",
        "(?:should be|expected)\\s+['\"]?([\\w.-]+)['\"]?\\s+but\\s+(?:is|found|actual)\\s+['\"]?([\\w.-]+)['\"]?"
      ],
      "negative_patterns": [
        "fixing\\s+configuration",
        "applied\\s+fix",
        "reconfiguring"
      ],
      "confidence_weight": 0.85,
      "extract_fields": {
        "description": "$1"
      }
    },
    {
      "id": "rule_drift_detected",
      "category": "drift_detected",
      "target_section": "application_services",
      "patterns": [
        "(?:drift|mismatch)\\s+detected[:\\s]+(.+?)(?:\\.|$)",
        "actual\\s+(?:state|value|config)\\s+differs\\s+from\\s+(?:declared|expected|documented)",
        "(?:running|actual|live)\\s+(?:on|at)\\s+port\\s+(\\d+)\\s+but\\s+(?:context|config|documented)\\s+says\\s+(\\d+)",
        "(?:is|currently)\\s+(?:running|using|set to)\\s+['\"]?([\\w.-]+)['\"]?\\s+but\\s+(?:context|config)\\s+(?:says|shows)\\s+['\"]?([\\w.-]+)['\"]?"
      ],
      "negative_patterns": [
        "resolving\\s+drift",
        "fixing\\s+drift"
      ],
      "confidence_weight": 0.8,
      "extract_fields": {
        "actual": "$1",
        "expected": "$2"
      }
    },
    {
      "id": "rule_dependency_discovered",
      "category": "dependency_discovered",
      "target_section": "application_services",
      "patterns": [
        "(?:service|app)\\s+['\"]?([\\w-]+)['\"]?\\s+depends\\s+on\\s+['\"]?([\\w-]+)['\"]?",
        "(?:discovered|found)\\s+dependency\\s+(?:between|from)\\s+['\"]?([\\w-]+)['\"]?\\s+(?:to|and)\\s+['\"]?([\\w-]+)['\"]?",
        "['\"]?([\\w-]+)['\"]?\\s+(?:calls|connects to|requires)\\s+['\"]?([\\w-]+)['\"]?\\s+via\\s+(?:HTTP|gRPC|TCP)"
      ],
      "negative_patterns": [
        "adding\\s+dependency",
        "installing\\s+dependency"
      ],
      "confidence_weight": 0.75,
      "extract_fields": {
        "source": "$1",
        "target": "$2"
      }
    },
    {
      "id": "rule_ingress_host",
      "category": "topology_change",
      "target_section": "infrastructure_topology",
      "patterns": [
        "(?:new|discovered|found)\\s+ingress\\s+host\\s+['\"]?([\\w.-]+)['\"]?",
        "ingress\\s+['\"]?([\\w.-]+)['\"]?\\s+routes\\s+to\\s+['\"]?([\\w-]+)['\"]?",
        "(?:external|public)\\s+(?:endpoint|URL|host)\\s+['\"]?([\\w.-]+)['\"]?"
      ],
      "negative_patterns": [
        "kubectl\\s+(?:create|apply)\\s+ingress",
        "creating\\s+ingress"
      ],
      "confidence_weight": 0.8,
      "extract_fields": {
        "host": "$1",
        "backend": "$2"
      }
    }
  ],
  "global_negative_patterns": [
    "^\\s*\\$\\s+",
    "^\\s*#\\s+",
    "running\\s+command",
    "executing:",
    "output:",
    "^\\s*(?:NAME|STATUS|READY|AGE|RESTARTS)\\s+",
    "latency.*?\\d+ms",
    "CPU\\s+(?:usage|utilization)",
    "memory.*?\\d+[MGK]i",
    "\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}"
  ],
  "confidence_threshold": 0.7
}
