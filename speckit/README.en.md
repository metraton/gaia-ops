# Spec-Kit - Structured Feature Development System

**[ğŸ‡ªğŸ‡¸ VersiÃ³n en EspaÃ±ol](README.md)**

Structured workflow framework for specification-driven feature development. Spec-Kit is an open-source framework integrated as agentic functionality for Claude Code. It provides templates, scripts, and a lean agent (`speckit-planner`) that detects the current workflow phase from existing artifacts and loads the corresponding skill â€” no slash commands needed. governance.md is auto-generated on first use and kept in sync with `project-context.json` on every session.

## Table of Contents

- [Overview](#overview)
- [Architecture](#architecture)
- [Installation](#installation)
- [Skills Reference](#skills-reference)
- [Scripts Reference](#scripts-reference)
- [Auto-Enrichment](#auto-enrichment)
- [Agent Routing](#agent-routing)
- [Troubleshooting](#troubleshooting)
- [Best Practices](#best-practices)
- [References](#references)
- [Support](#support)

## Overview

### What is Spec-Kit?

Spec-Kit provides structured workflow for feature development:
1. **Specify** - Define feature specifications
2. **Clarify** - Resolve ambiguities before planning
3. **Plan** - Create technical implementation plans
4. **Tasks** - Generate actionable task lists with metadata
5. **Analyze** - Validate consistency across artifacts
6. **Implement** - Execute tasks with automatic risk analysis
7. **Status** - Inspect current feature state and get the exact next command
8. **Validate** - Detect drift between declared and real completion
9. **Governance** - Maintain project governance principles

### Key Features

- âœ… **Natural language** - No slash commands; describe what you need in plain language
- âœ… **Phase auto-detection** - Agent reads artifacts and knows which skill to apply
- âœ… **Governance auto-sync** - governance.md generated on first use, kept in sync with project-context on every session
- âœ… **GOVERNANCE_UPDATE** - specify and plan skills detect new technologies and update governance.md automatically
- âœ… **Multi-project** - Work with multiple spec-kits simultaneously
- âœ… **Portable** - Works with any project structure
- âœ… **Auto-enrichment** - Tasks automatically tagged with agent routing metadata
- âœ… **Risk analysis** - High-risk tasks (T2/T3) analyzed before execution
- âœ… **Agent routing** - Tasks routed to specialized agents automatically
- âœ… **Git-agnostic** - User controls Git workflow independently
- âœ… **Template-based** - Consistent structure across features
- âœ… **State machine** - Always know where you are and what to run next
- âœ… **Drift detection** - Verify declared completions against real code evidence

## Architecture

### Directory Structure

```
.claude/speckit/
â”œâ”€â”€ README.md                # Spanish documentation
â”œâ”€â”€ README.en.md             # This file - English documentation
â”œâ”€â”€ scripts/                 # 5 bash scripts for automation
â”‚   â”œâ”€â”€ common.sh            # Shared functions (get_feature_paths)
â”‚   â”œâ”€â”€ create-new-feature.sh   # Create feature directory
â”‚   â”œâ”€â”€ check-prerequisites.sh  # Validate prerequisites
â”‚   â”œâ”€â”€ setup-plan.sh        # Setup plan template
â”‚   â””â”€â”€ update-agent-context.sh # Update agent context
â”œâ”€â”€ templates/               # 5 markdown templates
â”‚   â”œâ”€â”€ spec-template.md     # Feature specification template
â”‚   â”œâ”€â”€ plan-template.md     # Implementation plan template
â”‚   â”œâ”€â”€ tasks-template.md    # Task list template
â”‚   â”œâ”€â”€ adr-template.md      # Architecture Decision Record template
â”‚   â””â”€â”€ agent-file-template.md  # Agent context file template

.claude/agents/
â””â”€â”€ speckit-planner.md       # Lean agent â€” phase detection + skill dispatch

.claude/skills/              # 9 speckit skills (one per workflow phase)
â”œâ”€â”€ speckit.init/SKILL.md        # Bootstrap project-context.json
â”œâ”€â”€ speckit.specify/SKILL.md     # Parse description, write spec.md
â”œâ”€â”€ speckit.plan/SKILL.md        # Generate plan.md + design artifacts
â”œâ”€â”€ speckit.tasks/SKILL.md       # Generate enriched tasks.md
â”œâ”€â”€ speckit.implement/SKILL.md   # Execute tasks with agents
â”œâ”€â”€ speckit.add-task/SKILL.md    # Add ad-hoc task with enrichment
â”œâ”€â”€ speckit.analyze-task/SKILL.md # Deep-dive before executing risky tasks
â”œâ”€â”€ speckit.status/SKILL.md      # State detection + next step
â””â”€â”€ speckit.validate/SKILL.md    # Drift detection

.claude/tools/               # Python utilities
â”œâ”€â”€ agent_router.py          # Route tasks to agents
â”œâ”€â”€ task_manager.py          # Manage task lifecycle
â””â”€â”€ clarify_engine.py        # Ambiguity detection

<project-root>/              # User-specified root (e.g., spec-kit-tcm-plan/)
â”œâ”€â”€ governance.md            # Auto-generated by gaia-init, synced from project-context.json
â””â”€â”€ specs/                   # Feature specifications
    â”œâ”€â”€ 001-feature-name/
    â”‚   â”œâ”€â”€ spec.md          # Feature specification
    â”‚   â”œâ”€â”€ plan.md          # Implementation plan
    â”‚   â”œâ”€â”€ tasks.md         # Task list (auto-enriched)
    â”‚   â”œâ”€â”€ research.md      # Research notes (optional)
    â”‚   â”œâ”€â”€ data-model.md    # Data model (optional)
    â”‚   â””â”€â”€ contracts/       # API contracts (optional)
    â””â”€â”€ 002-feature-name/
```

### Component Responsibilities

| Component | Responsibility | Used By |
|-----------|---------------|---------|
| **speckit-planner** | Phase detection, skill dispatch | Claude orchestrator |
| **Skills** | Per-phase process and protocol | Agent automatically |
| **Scripts** | Automation and path resolution | Agent via Bash |
| **Templates** | Consistent artifact structure | Scripts during creation |
| **Governance** | Project governance principles | All planning skills |

## Installation

### Initial Setup

**Step 1: Create project directory**
```bash
mkdir -p spec-kit-tcm-plan/specs
```

**Step 2: Bootstrap project context** (natural language)
```
"initialize speckit for this project"
"bootstrap spec-kit-tcm-plan"
```

**Ready!** The `speckit-planner` agent detects the phase automatically. Example conversation:

```
"I want to add dark mode to the settings page"
â†’ Agent detects: no spec.md â†’ runs speckit.specify skill â†’ writes spec.md

"plan the dark mode feature"
â†’ Agent detects: spec.md exists, no plan.md â†’ runs speckit.plan skill â†’ writes plan.md

"generate tasks for 001-dark-mode"
â†’ Agent detects: plan.md exists, no tasks.md â†’ runs speckit.tasks skill â†’ writes tasks.md

"implement 001-dark-mode"
â†’ Agent detects: tasks.md exists â†’ runs speckit.implement skill
```

---

## Skills Reference

The `speckit-planner` agent loads the appropriate skill based on phase detection. Users interact in natural language â€” no slash commands.

| Skill | Phase | Purpose | Trigger phrase examples |
|-------|-------|---------|------------------------|
| **speckit.init** | Step 0 (automatic) | Verify prerequisites, generate/sync governance.md | Runs silently â€” user does not invoke directly |
| **speckit.specify** | Specify | Parse description, write spec.md | "I want to add X", "create spec for Y" |
| **speckit.plan** | Plan | Generate plan.md + design artifacts | "plan feature X", "generate implementation plan" |
| **speckit.tasks** | Tasks | Generate enriched tasks.md | "generate tasks for X", "create task list" |
| **speckit.implement** | Implement | Execute tasks with agents | "implement X", "execute task plan" |
| **speckit.add-task** | Ad-hoc | Add task with auto-enrichment | "add a task for X", "I need a task to fix Y" |
| **speckit.analyze-task** | Analysis | Deep-dive before executing risky task | "analyze T042", "what does T015 do" |
| **speckit.status** | Orientation | State detection + exact next step | "where are we with feature X", "what's next" |
| **speckit.validate** | Verification | Detect drift between tasks.md and code | "validate feature X", "check completion" |

> **speckit.init** runs automatically as Step 0 before any agent action. It generates `governance.md` on first use and syncs it with `project-context.json` on subsequent sessions â€” silently unless changes are made.

---

## Scripts Reference

Location: `.claude/speckit/scripts/`

- `common.sh`: Shared functions (`get_feature_paths`, path resolution from arguments)
- `create-new-feature.sh`: Creates feature structure and `spec.md`
- `check-prerequisites.sh`: Validates required and optional artifacts
- `setup-plan.sh`: Creates `plan.md` from template
- `update-agent-context.sh`: Syncs agent context

---

## Auto-Enrichment

### What is Auto-Enrichment?

Automatic injection of metadata into tasks for agent routing and risk assessment.

### When Does It Happen?

**Automatic enrichment:**
- âœ¨ Tasks phase (`speckit.tasks` skill) â€” all tasks enriched when generated
- âœ¨ Add-task phase (`speckit.add-task` skill) â€” new task enriched when added

**No manual enrichment step needed**

### Enrichment Process

**Step 1: Agent routing**
```bash
python3 .claude/tools/agent_router.py --json "Task description"
```

**Step 3: Metadata injection**
```markdown
- [ ] T001 Create GKE cluster
  <!-- ğŸ¤– Agent: terraform-architect | âœ… T1 | â“ 0.85 -->
  <!-- ğŸ·ï¸ Tags: #terraform #gcp #gke -->
  <!-- ğŸ¯ skill: terraform_operations (8.0) -->
  <!-- ğŸ”„ Fallback: devops-developer -->
```

### Metadata Components

**Agent assignment:**
```
ğŸ¤– Agent: terraform-architect
```
Primary agent for task execution

**Risk tier:**
```
âœ… T0 (read-only)
âœ… T1 (validation)
ğŸ”’ T2 (simulation) - Requires analysis
ğŸš« T3 (blocked) - Not executed
```

**Confidence score:**
```
â“ 0.85 (0.0-1.0 scale)
```
Router confidence in agent assignment

**Tags:**
```
ğŸ·ï¸ Tags: #terraform #gcp #gke
```
Technology and domain tags

**Skill scores:**
```
ğŸ¯ skill: terraform_operations (8.0)
```
Agent capability match

**Fallback agent:**
```
ğŸ”„ Fallback: devops-developer
```
Alternative if primary fails

**High-risk warning:**
```
âš ï¸ HIGH RISK: Analyze before execution
ğŸ’¡ Suggested: analyze task T001
```
For T2/T3 tasks only. The implement skill triggers analysis automatically.

**Low-confidence warning** (score < 0.5):
```
âš ï¸ LOW_CONFIDENCE: score=0.3 â€” review agent routing manually
```
Emitted automatically when routing confidence falls below `MIN_CONFIDENCE: 0.5`

### Enrichment Benefits

- [x] Automatic agent routing
- [x] Risk visibility
- [x] Execution safety
- [x] Audit trail
- [x] Team coordination
- [x] Confidence threshold warnings (MIN_CONFIDENCE: 0.5)
- [x] Machine-readable dependency graph (YAML) in tasks.md

## Agent Routing

### How Routing Works

**Step 1: Parse task metadata**
```markdown
<!-- ğŸ¤– Agent: gitops-operator | âœ… T0 | â“ 0.92 -->
```

**Step 2: Load agent context**
```python
from .claude.tools.context_section_reader import ContextSectionReader
context = reader.get_for_agent('gitops-operator')
```

**Step 3: Invoke specialized agent**
```python
Task(
    subagent_type='gitops-operator',
    prompt=f"{context}\n\n{task_instructions}"
)
```

### Available Agents

| Agent | Specialization | Risk Tiers |
|-------|---------------|-----------|
| **terraform-architect** | Terraform/Terragrunt validation | T0-T1 |
| **gitops-operator** | Kubernetes/Flux operations | T0-T1 |
| **cloud-troubleshooter** | GCP diagnostics | T0 only |
| **devops-developer** | Application development | T0-T2 |
| **cloud-troubleshooter** | AWS diagnostics (standby) | T0 only |

### Routing Decision Factors

**Keyword matching:**
- "terraform" â†’ terraform-architect
- "kubectl", "flux" â†’ gitops-operator
- "gcp", "gke" â†’ cloud-troubleshooter
- "build", "test" â†’ devops-developer

**Skill scoring:**
```
Agent: gitops-operator
- skill: kubernetes_operations (9.0)
- skill: flux_operations (8.5)
- skill: helm_management (7.0)
```

**Context requirements:**
- Cluster name â†’ gitops-operator, cloud-troubleshooter
- Terraform path â†’ terraform-architect
- Repository â†’ devops-developer

### Routing CLI

**Manual routing (for debugging):**
```bash
python3 .claude/tools/agent_router.py --json "Check pods in namespace"
python3 .claude/tools/agent_router.py --explain "Validate terraform config"
python3 .claude/tools/agent_router.py --test
```

### Fallback Behavior

**If primary agent fails:**
1. Check fallback agent in metadata
2. Retry with fallback
3. If fallback fails, escalate to user

**If no agent specified:**
- Default to `devops-developer` (general-purpose)

## Troubleshooting

### Config Not Found

**Error:**
```
ERROR: project-context.json not found
```

**Solution:**
Ask the agent to initialize: "initialize speckit for this project" or "bootstrap spec-kit-tcm-plan". The agent will ask for project details interactively.

---

### Governance File Not Found

**This should not happen in normal operation.** The agent generates governance.md automatically as Step 0 on first use.

**If it occurs:**
```
WARNING: governance.md not found at spec-kit-tcm-plan/governance.md
```

**Solution:**
Ask the agent: "initialize speckit". The speckit.init skill will generate governance.md from your project-context.json values. Alternatively, ensure `paths.speckit_root` is set in `.claude/project-context/project-context.json`.

---

### Feature Directory Missing

**Error:**
```
ERROR: Feature directory not found
```

**Solution:**
Ask the agent to create the feature: "I want to specify a new feature for dark mode". The agent will run the specify skill and create the directory.

---

### Plan Missing

**Error:**
```
ERROR: plan.md not found in spec-kit-tcm-plan/specs/003-feature-name
```

**Solution:**
Ask the agent: "plan feature 003-feature-name". The agent detects the missing plan.md and runs the plan skill.

---

### Tasks Not Enriched

**Symptoms:**
- Tasks missing metadata comments
- No agent assignments
- No risk tiers

**Solution:**
Tasks are automatically enriched by the tasks skill and add-task skill. No manual action needed.

**Verify enrichment:**
```bash
grep "ğŸ¤– Agent:" spec-kit-tcm-plan/specs/003-feature-name/tasks.md
```

---

### Wrong Agent Assigned

**Symptoms:**
- Task routed to incorrect agent
- Low confidence score (<0.5) with `âš ï¸ LOW_CONFIDENCE` warning

**Solution:**
Edit the metadata comment in tasks.md manually:
```markdown
- [ ] T001 Task description
  <!-- ğŸ¤– Agent: correct-agent | âœ… T1 | â“ 0.85 -->
```

---

### High-Risk Task Blocked

**Symptoms:**
- Task marked with âš ï¸ HIGH RISK
- Agent requests confirmation before proceeding

**This is expected behavior for T2/T3 tasks**

**Solution:**
1. Review the analysis the agent presents automatically
2. Confirm "yes" to proceed or "no" to skip
3. If not safe, ask the agent to modify the approach

---

### JQ Not Installed

**Error:**
```
ERROR: jq is required but not installed
```

**Solution:**
```bash
# macOS
brew install jq

# Ubuntu/Debian
sudo apt-get install jq

# Verify installation
jq --version
```

## Best Practices

### Configuration Management

- âœ… Run `npx gaia-init` once per project to generate project-context.json and governance.md
- âœ… Set `paths.speckit_root` in project-context.json so the agent knows where governance.md lives
- âœ… Don't hardcode paths in custom scripts
- âœ… Trust governance auto-sync â€” don't edit governance.md manually for stack values

### Feature Development

- âœ… Ask "where are we with feature X?" to orient yourself at any time
- âœ… Let the agent detect the phase â€” don't force a specific skill
- âœ… Follow workflow order (specify â†’ plan â†’ tasks â†’ implement)
- âœ… Let auto-enrichment handle metadata (don't edit manually)
- âœ… Ask "validate feature X" after implementation to confirm real completion

### Risk Management

- âœ… Always analyze T2/T3 tasks before execution
- âœ… Review agent assignments for tasks with LOW_CONFIDENCE warnings (score < 0.5)
- âœ… Keep confidence scores >0.7 for critical operations
- âœ… Use fallback agents when primary confidence is low

### Git Workflow

- âœ… User controls Git workflow (no auto-branching)
- âœ… Branch when ready (not enforced by scripts)
- âœ… Commit regularly during implementation
- âœ… Use descriptive commit messages

### Documentation

- âœ… Keep governance.md up-to-date with learnings
- âœ… Document architecture decisions in plan.md
- âœ… Create research.md for investigation notes
- âœ… Use contracts/ for API specifications

## References

### Internal Documentation

- `.claude/README.md` - Complete agent system documentation
- `.claude/project-context/project-context.json` - Project-specific context
- `CLAUDE.md` - Repository guidance for Claude Code
- `spec-kit-tcm-plan/governance.md` - Project governance principles

### Agent and Skills

Agent: `.claude/agents/speckit-planner.md`

Skills in `.claude/skills/speckit.*/SKILL.md`:
- speckit.init
- speckit.specify
- speckit.plan
- speckit.tasks
- speckit.analyze-task
- speckit.implement
- speckit.add-task
- speckit.status
- speckit.validate

### Tool Files

- `.claude/tools/agent_router.py` - Agent routing logic
- `.claude/tools/task_manager.py` - Task lifecycle management
- `.claude/tools/clarify_engine.py` - Ambiguity detection
- `.claude/tools/context_provider.py` - Context provisioning

**Framework Base**

Spec-Kit is an open-source framework adapted as agentic functionality for Claude Code. Main modifications:

- âœ… Natural language interaction - No slash commands
- âœ… Governance auto-sync - governance.md generated and kept in sync automatically
- âœ… Auto-enrichment - Tasks with routing metadata
- âœ… Risk analysis - T0-T3 with automatic validation
- âœ… Multi-project - Simultaneous spec support
- âœ… Agentic integration - Automatic routing to specialized agents

---

## Support

**For Claude orchestrator:**
- Route to `speckit-planner` when user mentions "speckit", "spec-kit", "feature planning", or "create spec"
- The agent detects the phase and loads the correct skill automatically
- Do not invoke specific skills directly â€” let the agent dispatch

**For users:**
- Describe what you need in natural language
- Create project directory first: `mkdir -p spec-kit-tcm-plan/specs`
- Ask "where are we?" or "what's next?" at any point to orient yourself
- Trust auto-enrichment (don't edit metadata manually)
- The agent will ask for confirmation before any high-risk task

**For Spanish documentation:** Ver [README.md](README.md)

---

**Version:** 2.3.0 | **Updated:** 2026-02-23
